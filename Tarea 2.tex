\documentclass{article}
\usepackage[utf8]{inputenc}

\usepackage{hyperref}

\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
    pdftitle={Overleaf Example},
    pdfpagemode=FullScreen,
    }
    
\urlstyle{same}
    
\title{Principios de Seguridad en Sistemas Operativos \\ Tarea 2 Race Condition Vulnerability}
\author{Juan Jose Araya Castro \\
Alvaro Andrei Miranda Muñoz}
\date{August 2022}

\begin{document}

\maketitle

\begin{minipage}{\textwidth}
Código curso: MC1005\\
Due: Agosto 17, 2022 at 23:59 (CST)\\
Total puntos: 10 puntos\\
\end{minipage}
    
\section*{Introducción}
El objetivo de este ataque es aprovechar la vulnerabilidad existente de condición de carrera en la que son ejecutados los procesos utilizando un archivo que posee el máximo nivel de permisos (root) al mismo tiempo ejecutado un archivo que posee permisos de un usuario normal. Esto además se logra mediante el seteo de links simbólicos en el sistema, hoy en día esta vulnerabilidad ya se encuentra cubierta, aún así este método de protección puede ser desactivado de manera manual, si el usuario administrador lo decide y deja esta ventana abierta para los diferentes atacantes.

\section*{Instrucciones Generales}

Para este ataque es necesario un archivo con permisos de root el cual sera vulp, quien puede ser utilizado por cualquier usuario en el equipo sin importar los permisos de cada usuario, luego debemos ubicarnos en un usuario que no posea los permisos de administrador (root) para ejecutar nuestro script y al mismo tiempo utilizar vulp para intentar escribir en un archivo de acceso exclusivo para root.

\begin{enumerate}
  \item Deshabilitar la bandera del sistema que bloquea este tipos de ataque con el comando: "sudo sysctl -w fs.protected\_symlinks=0"
  \item Debemos seleccionar cual archivo debemos atacar en este caso seria Shadow o Passwd. (Nosotros realizamos el ataque a ambos para verificar la funcionalidad)
  
  \item Luego debemos crear un archivo de texto donde guardaremos el string que deseamos inyectar en alguno de los archivos atacados. En nuestro caso son: pass\_input y shadow\_input
  
  \item Luego de definir el nombre del archivo de texto debemos modificarlo en el archivo "target\_1.sh"
  
  \item Dentro del archivo de "pass\_input" que definimos ingresamos el valor de "hacker:U6aMy0wojraho:0:0::/home/hacker:/bin/bash"
  
  \item Cuando el ataque tiene éxito, puede ser prácticamente de inmediato o tomar algunos minutos pero este tendrá éxito en este escenario.
  
  \item Ingresamos al usuario inyectado por el ataque y una vez dentro del perfil inyectado dados los parámetros definidos por el ataque este usuario poseerá control total del equipo como un usuario "root"
  
  \item Teniendo control de la máquina con este usuario que se agregó, podemos modificar otros archivos manualmente y ejecutar cualquier optro script o modificar otro archivo que pertenezca a root como el shadow 
  
\end{enumerate}


\section*{Descripción del Ataque}

\tab \qquad Según Wikipedia la condición de carrera es algo que afecta electrónicos, software y otros sistemas que dependen de una secuencia de tiempo sobre eventos incontrolables esto se vuelve un error cuando uno o mas comportamientos se vuelven indeseables.
\\

La idea del ataque es hacerle pensar al equipo que el usuario root con el mayor nivel de permisos en el sistema desea realizar cambios sobre un archivo en específico. Mediante iteraciones infinitas se puede correr un script de manera constante y que solamente este usuario root pueda modificar el archivo cuando realmente es un usuario sin privilegios, esto se logra creando symbolic links que apunten a un archivo de sistema que pertenezca a root. 
\\ 

Lo que se busca es obtener un nivel de permisos de root para modificar cualquier archivo o configuración del equipo, una vez logrado este paso se puede tomar como un ataque satisfactorio.

\\
\\



\section*{Documentación del Ataque}

Vídeos de las ejecuciones y los ataques: \\

\begin{enumerate}
  \item Actividad 1:

  \href{https://www.loom.com/share/622ec72dc2cb4c658d06e8dee2589afd}{Alvaro Miranda - Juan Jose Araya - Actividad 1.1} \\
  
  \href{https://www.loom.com/share/7ac21ee2b903425195a60f802dd6a9c9}{Alvaro Miranda - Juan Jose Araya - Actividad 1.2} \\
  
  \item Actividad 2:
  
  \href{https://www.loom.com/share/36b82066d6d043168116ed0fc0b293b6}{Alvaro Miranda - Juan Jose Araya - Actividad 2.1} \\
  
  \href{https://www.loom.com/share/6dc3ff3fbb97469085bb2e26dcbf3220}{Alvaro Miranda - Juan Jose Araya - Actividad 2.2} \\
  
  \href{https://www.loom.com/share/466ba0ef96464f9a95a7eb8b19e8fb2f}{Alvaro Miranda - Juan Jose Araya - Actividad 2.3} \\
  
  \item Actividad 3:
  
  \href{https://www.loom.com/share/ae3e916e6bf14555b860367652aa316d}{Alvaro Miranda - Juan Jose Araya - Actividad 3} \\
  
\end{enumerate}



\section*{Autoevaluación}

\begin{enumerate}
    \item Estado Final: Completado
    \item Problemas Encontrados: Existencia de una bandera la cual bloquea estos tipos de ataques además de que al recompilar el archivo .c perdía los permisos de root, lo cual nos retrasaba en las pruebas y confirmación de los cambios realizados.
    \item Limitaciones Adicionales: Falsos positivos, inicialmente ejecutamos los scripts con un usuario el cual poseía permisos de administrador o root por lo que el ataque se ejecutaba en la primera o segunda ejecución, además para realizar el ataque en las nuevas versiones debemos deshabilitar una bandera de seguridad descubrimos que luego de reiniciar el equipo virtual se reiniciaba la bandera por lo que sufrimos varios días sin saber que dado el reinicio el ataque no funcionaba.
    \item Reporte de Commits en Git: \href{https://github.com/varitomirandacr/SeguridadSO_RaceCondition/commits/main}{Commits History}
    \item Evaluación: 100\%
\end{enumerate}

    \noindent\rule{10cm}{0.4pt} \\
    Rubro   \qquad \qquad \qquad \qquad Puntaje Total    \qquad  Puntaje Obtenido \\
    \noindent\rule{10cm}{0.4pt} \\
    Actividad 1: \qquad \qquad \qquad \qquad \ 25 \qquad \qquad \qquad 25\\ 
    \noindent\rule{10cm}{0.1pt} \\
    Actividad 2: \qquad \qquad \qquad \qquad \ 25 \qquad \qquad \qquad 25\\ 
    \noindent\rule{10cm}{0.1pt} \\
    Actividad 3: \qquad \qquad \qquad \qquad \ 25 \qquad \qquad \qquad 25\\ 
    \noindent\rule{10cm}{0.1pt} \\
    Documentación del Ataque: \quad \ \ 25 \qquad \qquad \qquad 25\\ 
    \noindent\rule{10cm}{0.1pt} \\

\section*{Lecciones Aprendidas}

Este proyecto de Vulnerabilidad de Condición de Carrera nos muestra lo vulnerable que eran los sistemas aun cuando teníamos diferentes capaz de seguridad, como por ejemplo discos encriptados, antivirus, puertos usb deshabilitados etc.

\begin{enumerate}
    \item En nuestro caso nos fue dado un archivo con código en C llamado vulp, que teníamos que compilar. Parte de la vulnerabilidad radica en ignorar algunos puntos de buenas prácticas que hubieran impedido el ataque. 
    
    \item Con respecto al escenario 2 logramos entender de que es necesario comprobar los archivos, su contenido, su integridad, en este caso fue especificamente con los i-nodes, sin embargo existen otras formas de comprobar archivos.
    
    \item En el caso del Least Privilege, entendemos la importancia de impedir que un usuario que no realiza la llamada logre ejecutar una operación, parte de esto representa el core de la vulnerabilidad de condición de carrera.
    
    \item Ningún archivo con acceso de root o información delicada o sensible deberia estar a la mano de un usuario que no tenga permisos de root o administrador, ya que puede sentar las bases para abrir una ventana para un posible ataque.
    
    \item Mantener los sistemas actualizados con las últimas actualizaciones de seguridad del sistema operativo, dado que este tipo de ataques se soluciona con una de las versiones posteriores al SO que utilizamos.
    
\end{enumerate}

\section*{Bibliografía}

\begin{itemize}
  \item Laboratory for Computer Security Education. \href{https://www.utc.edu/sites/default/files/2021-04/race-condition.pdf}{UTC EDU Race Condition}
  
  \item Lecture Notes (Syracuse University). \href{https://web.ecs.syr.edu/~wedu/Teaching/cis643/LectureNotes_New/Set_UID.pdf}{Set-UID Privileged Programs}
  
  \item SEED Labs – Race Condition Vulnerability Lab. \href{https://seedsecuritylabs.org/Labs_16.04/PDF/Race_Condition_new.pdf}{Race Condition Vulnerability Lab}
  
  \item Race Condition Vulnerability \href{https://moodle1920.up.pt/pluginfile.php/132925/mod_resource/content/1/Race_Condition_Extra.pdf}{Race Condition Vulnerability}
  
  \item Race condition \href{https://en.wikipedia.org/wiki/Race_condition}{Race condition}
  
\end{itemize}

\end{document}

